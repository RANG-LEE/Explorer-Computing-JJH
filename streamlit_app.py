import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import r2_score

def load_data():
    df = pd.read_csv("./Ex_ch_sourcefiles/data/cars.csv") #githubì—ì„œ ë¶ˆëŸ¬ì˜¬ ë•ŒëŠ” ./data/cars.csv"
    return df

# --- 1í˜ì´ì§€: ìê¸°ì†Œê°œ í˜ì´ì§€ í•¨ìˆ˜ ---
def page_intro():
    st.title("ë‚˜ì˜ ì†Œê°œ í˜ì´ì§€") #ëŒ€ì œëª©

    st.header("ìê¸°ì†Œê°œ") # ì¤‘ì œëª©
    st.write({"ì´ë¦„": "ì •ì§€í˜¸", "ë‚˜ì´": "02ë…„ìƒ", "ì „ê³µ": "ì‹í’ˆìƒëª…ê³µí•™"}) #ë”•ì…”ë„ˆë¦¬
    st.write("ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” **ì‹í’ˆìƒëª…ê³µí•™** ì „ê³µ 21í•™ë²ˆ ì •ì§€í˜¸ì…ë‹ˆë‹¤. ì €ëŠ” í˜„ì¬ 4í•™ë…„ìœ¼ë¡œ ì¬í•™ ì¤‘ì…ë‹ˆë‹¤.\
            ë³¸ í•™ê¸°ì—ëŠ” ì—°ê³„ì „ê³µ ìˆ˜ì—…ìœ¼ë¡œ *ê²½ì œ*ë¥¼ ê³µë¶€í•˜ê³  ìˆìœ¼ë©°, êµì–‘ìœ¼ë¡œ *'ì»´í“¨íŒ… íƒìƒ‰'* íŒŒì´ì¬ ìˆ˜ì—…ë„ ê³µë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\
            í˜„ì¬ ê°€ì¥ í° ê´€ì‹¬ì‚¬ëŠ” **ì¡¸ì—… í›„ ì§„ë¡œì— ëŒ€í•œ ê³ ë¯¼**ì…ë‹ˆë‹¤. ì•„ì§ ì»´í“¨íŒ…ì„ íƒìƒ‰í•˜ë“¯ ì§„ë¡œ íƒìƒ‰ ì¤‘ì´ì§€ë§Œ, ì´ë¥¼ ìœ„í•´ì„œ í˜„ì¬ ë‹¤ì–‘í•œ ê²½ë¡œë¡œ ê³ ë¯¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.") #ë³¸ë¬¸

    st.subheader("ì´ë²ˆ í•™ê¸° ìˆ˜ê°• ê³¼ëª©")
    st.write(pd.DataFrame({"A": ['ë¯¸ì‹œê²½ì œí•™', 'ê±°ì‹œê²½ì œí•™', 'ì»´í“¨íŒ… í•µì‹¬', 'ì»´í“¨íŒ… íƒìƒ‰']})) # ë°ì´í„°í”„ë ˆì„

    st.subheader("ì¢‹ì•„í•˜ëŠ” ê²ƒ")
    st.write("ì œê°€ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ê²ƒì€ **ë””ì €íŠ¸**ì…ë‹ˆë‹¤. ì˜ ë§Œë“¤ì–´ì§„ ì¼€ì´í¬ì™€ ìŒë£Œ í•œ ì”ì€ ì €ì—ê²Œ í° í–‰ë³µì„ ì£¼ê³¤ í•©ë‹ˆë‹¤.\
            ë³¸ê°€ì— ì§€ë‚¼ ë•ŒëŠ” ê°€ë”ì”© ë§ˆë“¤ë Œ, íœ˜ë‚­ì‹œì—, ê°„ë‹¨í•œ êµ¬ì›€ê³¼ìë“¤ì„ ë§Œë“¤ì–´ ë¨¹ê³¤ í–ˆìŠµë‹ˆë‹¤. ê±´ê°•ì— ì¢‹ì€ ìŒì‹ì€ ì•„ë‹ˆì§€ë§Œ, ì¡°ë§Œê°„ ë¨¹ëŠ” ë””ì €íŠ¸ë“¤ì€ ì œ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.")
    st.write("ëŒ€ë¦¬ë§Œì¡± ì‚¼ì•„ ì°¾ì•„ë³´ëŠ” *ë¹µë”˜*ì´ë¼ëŠ” ì´ë¦„ì˜ ìœ íŠœë²„ ë§í¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. [ë¹µë”˜ ìœ íŠœë¸Œ ë§í¬](https://www.youtube.com/@ë¹µë”˜)")

    st.subheader("ì•ìœ¼ë¡œì˜ ëª©í‘œ")
    st.write("ì•ìœ¼ë¡œì˜ ëª©í‘œëŠ” **ë‹¤ì–‘í•œ ê²½í—˜**ì„ ìŒ“ëŠ” ê²ƒì…ë‹ˆë‹¤. ëŒ€í•™ ìƒí™œ ë™ì•ˆ ì—¬ëŸ¬ í™œë™ì— ì°¸ì—¬í•˜ë©° ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ì„ ë§Œë‚˜ê³ , ìƒˆë¡œìš´ ì§€ì‹ì„ ìŠµë“í•˜ëŠ” ê²ƒì´ ì €ì˜ ëª©í‘œì…ë‹ˆë‹¤.\
            ì´ë¥¼ í†µí•´ í­ë„“ì€ ì‹œì•¼ë¥¼ ê°–ì¶”ê³ , ì¡¸ì—… í›„ì— í•  ìˆ˜ ìˆëŠ” ì œê°€ ê·¸ë‚˜ë§ˆ ë” ì›í•˜ëŠ” ê¸¸ì„ ì°¾ê³  ì‹¶ìŠµë‹ˆë‹¤.")

    st.code("print('Hello, my name is jiho.')", language="python")
    st.latex(r"E = mc^2")

# --- 2í˜ì´ì§€: ìˆ˜ì—… ì‹œê°„í‘œ í˜ì´ì§€ í•¨ìˆ˜ ---
def page_timetable():
    st.title("ğŸ“š ë‚˜ì˜ ìˆ˜ì—… ì‹œê°„í‘œ") #ëŒ€ì œëª©

    # ìƒ˜í”Œ ë°ì´í„°
    data = {"ìš”ì¼": ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ"],"1êµì‹œ": ["ì»´í“¨íŒ… í•µì‹¬", "ê±°ì‹œê²½ì œì´ë¡ ", "ì»´í“¨íŒ… í•µì‹¬", "", "ì»´í“¨íŒ… íƒìƒ‰"], "2êµì‹œ": ["", "", "ë¯¸ì‹œê²½ì œì´ë¡ ", "", ""]}
    df = pd.DataFrame(data)

    # st.table(): ì •ì ì¸ í…Œì´ë¸”ì„ í‘œì‹œ. ê°„ë‹¨í•œ ë°ì´í„° í”„ë ˆì„ì´ë‚˜ ë°°ì—´ì„ ê¹”ë”í•˜ê²Œ í‘œì‹œí•  ë•Œ ìœ ìš©.
    st.write("### ì •ì  ì‹œê°„í‘œ (st.table)")
    st.table(df)


    # st.json(): JSON ë°ì´í„° êµ¬ì¡°ë¥¼ íŠ¸ë¦¬ í˜•íƒœë¡œ í‘œì‹œ. í¼ì¹˜ê¸°, ì ‘ê¸°ê°€ ê°€ëŠ¥
    json_data = {"ì»´íƒ": {"êµìˆ˜" : "ë³€í•´ì„ ", "ê°•ì˜ì‹¤":"26ë™ 104í˜¸"}, "ì»´í•µ": {"êµìˆ˜" : "ê¹€í˜„ì£¼", "ê°•ì˜ì‹¤":"26ë™ 104í˜¸"}, "ë¯¸ì‹œê²½ì œì´ë¡ ": {"êµìˆ˜":"Gueron Yves", "ê°•ì˜ì‹¤":"16ë™ 110í˜¸"}, "ê±°ì‹œê²½ì œì´ë¡ ": {"êµìˆ˜":"ìµœì¬ì›", "ê°•ì˜ì‹¤":"223ë™ 107í˜¸"}}
    st.write("### ìˆ˜ì—… ì •ë³´ (st.json)")
    st.json(json_data)


    #ì§€í‘œ(ìˆ«ì+ì¦ê°ë¥ ) í‘œì‹œ
    st.write("### ì´ë²ˆ í•™ê¸° ìš”ì•½ (st.metric)")
    st.metric(label="ìˆ˜ê°• ê³¼ëª© ìˆ˜", value="4")
    st.metric(label="ì´ í•™ì ", value="12", delta="-6", delta_color="inverse") # 6í•™ì ì´ ì¤„ì–´ë“  ê²ƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œ

def cars_home():
    st.title("ğŸš— ìë™ì°¨ ì—°ë¹„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ")

    st.write("""
    ì´ ëŒ€ì‹œë³´ë“œëŠ” ìë™ì°¨ ì„±ëŠ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ  
    **ëŒ€ë¥™ë³„ í‰ê·  ì—°ë¹„, ë§ˆë ¥(hp)ê³¼ ì—°ë¹„(mpg) ê´€ê³„, ì°¨ëŸ‰ ë¬´ê²Œì™€ ì—°ë¹„ ê´€ê³„, ì—°ë„ë³„ í‰ê·  ì—°ë¹„ ë³€í™”**ë“±ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.
    """)

    st.markdown("---")

    st.subheader("ğŸ“Š ì£¼ìš” ê¸°ëŠ¥")
    st.markdown("""
    1. **íƒìƒ‰ì  ìë£Œë¶„ì„ (EDA)**  
       - ì œì¡° ëŒ€ë¥™ë³„ í‰ê·  ì—°ë¹„ ë¹„êµ, ë§ˆë ¥ê³¼ ì°¨ëŸ‰ ë¬´ê²Œ ëŒ€ë¹„ ì—°ë¹„ ë¶„í¬, ì—°ë„ë³„ ì—°ë¹„ ë³€í™” ë“±ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.  
       - ê·¸ë˜í”„ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

    2. **ì—°ë¹„ ì˜ˆì¸¡**  
       - ì°¨ëŸ‰ì˜ ì œì›(`hp`, `weightlbs`, `cubicinches`, `cylinders`)ì„ ì…ë ¥í•˜ë©´  
         ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì´ ì˜ˆìƒ ì—°ë¹„ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.  

    3. **ì‹¤ì‹œê°„ ì¸í„°ë™í‹°ë¸Œ ì‹œê°í™”**  
       - ìŠ¬ë¼ì´ë”, ë“œë¡­ë‹¤ìš´ ë“± Streamlit ìœ„ì ¯ì„ í™œìš©í•˜ì—¬  
         ì¡°ê±´ì„ ë°”ê¾¸ë©´ ê·¸ë˜í”„ê°€ **ì¦‰ì‹œ ì—…ë°ì´íŠ¸**ë©ë‹ˆë‹¤.
    """)

    st.markdown("---")

    st.subheader("ğŸ’¡ í™œìš© í¬ì¸íŠ¸")
    st.info("""
    - ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ë©° **ì—°ë¹„ì— ì˜í–¥ì„ ì£¼ëŠ” ë³€ìˆ˜**ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
    - ì‚¬ìš©ìê°€ ì§ì ‘ ì¡°ê±´ì„ ì¡°ì •í•˜ë©´ì„œ **ì˜ˆìƒ ì—°ë¹„ ëª¨ë¸ì˜ ë°˜ì‘**ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
    - Streamlitì„ í™œìš©í•´ **ì›¹ ê¸°ë°˜ ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ** ì œì‘ì„ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    """)

    st.markdown("---")

    st.caption("ğŸ“ ë°ì´í„° ì¶œì²˜: Kaggle - Auto MPG Dataset")

def cars_EDA(df):
    st.title("ğŸ” ìë™ì°¨ ì—°ë¹„ ë¶„ì„ (EDA)")

    st.write("""
    ì´ íƒ­ì—ì„œëŠ” ìë™ì°¨ ì„±ëŠ¥ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬  
    **ì—°ë¹„(mpg)ì™€ ì£¼ìš” ë³€ìˆ˜ë“¤ ê°„ì˜ ê´€ê³„, ëŒ€ë¥™ë³„ íŠ¹ì„±, ì—°ë„ë³„ ë³€í™”** ë“±ì„ íƒìƒ‰í•©ë‹ˆë‹¤.
    """)

    # ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
    st.subheader("ğŸ“„ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°")
    st.dataframe(df.head())

    st.markdown("---")

    st.subheader("ğŸŒ ëŒ€ë¥™ë³„ í‰ê·  ì—°ë¹„")
    continent_mpg = df.groupby("continent")["mpg"].mean().reset_index()
    fig1 = px.bar(
        continent_mpg,
        x="continent",
        y="mpg",
        color="mpg",
        title="ëŒ€ë¥™ë³„ í‰ê·  ì—°ë¹„",
        color_continuous_scale="Greens"
    )
    # fig1.show() # vs codeì—ì„œ í™•ì¸ìš©

    st.plotly_chart(fig1, use_container_width=True) 
    # use_container_width :Streamlit í˜ì´ì§€ì˜ ê°€ë¡œ í­(ì»¨í…Œì´ë„ˆ ë„ˆë¹„)ì— ìë™ìœ¼ë¡œ ë§ì¶°ì§€ê²Œ í• ì§€ ì—¬ë¶€ë¥¼ ì„¤ì •í•˜ëŠ” ì˜µì…˜

    st.markdown("---")

    st.info("""
    ğŸ’¡ **ë¶„ì„ í¬ì¸íŠ¸**
    - ëŒ€ë¥™ë³„ë¡œ ì°¨ëŸ‰ íŠ¹ì„±ì´ ë‹¤ë¥´ë©°, ë¯¸êµ­ ì°¨ëŸ‰ì€ ë¹„êµì  ì—°ë¹„ê°€ ë‚®ê³  ì¼ë³¸ ì°¨ëŸ‰ì€ ì—°ë¹„ê°€ ë†’ì€ í¸ì…ë‹ˆë‹¤.  
    """)

    # ë§ˆë ¥(hp)ê³¼ ì—°ë¹„(mpg) ê´€ê³„

    st.subheader("âš¡ ë§ˆë ¥(hp)ê³¼ ì—°ë¹„(mpg) ê´€ê³„")
    fig2 = px.scatter(
        df,
        x="hp",
        y="mpg",
        color="continent",
        size="weightlbs",
        hover_name="continent",
        title="ë§ˆë ¥ ëŒ€ë¹„ ì—°ë¹„ ì‚°ì ë„"
    )
    #fig2.show() # vs codeì—ì„œ í™•ì¸ìš©
    st.plotly_chart(fig2, use_container_width=True)

    st.markdown("---")

    st.info("""
    ğŸ’¡ **ë¶„ì„ í¬ì¸íŠ¸**
    - ë§ˆë ¥ì´ ë†’ì„ìˆ˜ë¡ ì—°ë¹„ê°€ ë‚®ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.""")

    # ì°¨ëŸ‰ ë¬´ê²Œì™€ ì—°ë¹„ ê´€ê³„
    st.subheader("âš–ï¸ ì°¨ëŸ‰ ë¬´ê²Œ(weightlbs)ì™€ ì—°ë¹„ ê´€ê³„")
    fig3 = px.scatter(
        df,
        x="weightlbs",
        y="mpg",
        color="continent",
        size="hp",
        hover_name="continent",
        title="ì°¨ëŸ‰ ë¬´ê²Œ ëŒ€ë¹„ ì—°ë¹„ ì‚°ì ë„"
    )
    #fig3.show()
    st.plotly_chart(fig3, use_container_width=True)

    st.markdown("---")

    st.info("""
    ğŸ’¡ **ë¶„ì„ í¬ì¸íŠ¸**
    - ì°¨ëŸ‰ ë¬´ê²Œê°€ ë¬´ê±°ìš¸ìˆ˜ë¡ ì—°ë¹„ê°€ ë‚®ì•„ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.""") 

    # ì—°ë„ë³„ í‰ê·  ì—°ë¹„ ë³€í™”
    st.subheader("ğŸ“† ì—°ë„ë³„ í‰ê·  ì—°ë¹„ ë³€í™”")
    year_mpg = df.groupby("year")["mpg"].mean().reset_index()
    fig4 = px.line(
        year_mpg,
        x="year",
        y="mpg",
        title="ì—°ë„ë³„ í‰ê·  ì—°ë¹„ ì¶”ì´",
        markers=True
    )
    #fig4.show()
    st.plotly_chart(fig4, use_container_width=True)

    st.markdown("---")

    st.info("""
    ğŸ’¡ **ë¶„ì„ í¬ì¸íŠ¸**
    - ì—°ë„ë³„ í‰ê·  ì—°ë¹„ê°€ ì ì°¨ ê°œì„ ë˜ëŠ” ì¶”ì„¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.""")

def cars_predict(df):
    #ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ í™œìš©í•˜ì—¬ ìë™ì°¨ì˜ ì—°ë¹„ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤. 

    st.header("ğŸ¤– ìë™ì°¨ ì—°ë¹„ ì˜ˆì¸¡")
    st.write("ì„ í˜•íšŒê·€(Linear Regression) ëª¨ë¸ì„ í™œìš©í•˜ì—¬ ìë™ì°¨ì˜ ì—°ë¹„(mpg)ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.")

    # ì…ë ¥ ë³€ìˆ˜(X)ì™€ ëª©í‘œ ë³€ìˆ˜(y) ì„¤ì •
    X = df[["cylinders", "cubicinches", "hp", "weightlbs", "time-to-60"]]
    y = df["mpg"]

    # í•™ìŠµ ë°ì´í„°ì™€ í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„ë¦¬
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # ëª¨ë¸ í•™ìŠµ
    model = LinearRegression()
    model.fit(X_train, y_train)

    # ì˜ˆì¸¡ ì„±ëŠ¥ í‘œì‹œ
    y_pred = model.predict(X_test)
    score = r2_score(y_test, y_pred)
    st.write(f"ğŸ“Š ëª¨ë¸ ì„±ëŠ¥ (RÂ²): **{score:.3f}**")

    # ì‚¬ìš©ì ì…ë ¥
    st.subheader("ğŸš— ìë™ì°¨ ì •ë³´ ì…ë ¥")
    cylinders = st.slider("ì‹¤ë¦°ë” ìˆ˜ (cylinders)", 3, 12, 6)
    cubicinches = st.slider("ë°°ê¸°ëŸ‰ (cubicinches)", 60, 500, 200)
    hp = st.slider("ë§ˆë ¥ (horsepower)", 50, 400, 150)
    weightlbs = st.slider("ë¬´ê²Œ (weightlbs)", 1500, 6000, 3000)
    time_to_60 = st.slider("ì‹œì† 60ë§ˆì¼ ë„ë‹¬ ì‹œê°„ (ì´ˆ)", 4.0, 20.0, 10.0)

    # ì…ë ¥ê°’ìœ¼ë¡œ ì˜ˆì¸¡ ìˆ˜í–‰
    input_data = pd.DataFrame({
        "cylinders": [cylinders],
        "cubicinches": [cubicinches],
        "hp": [hp],
        "weightlbs": [weightlbs],
        "time-to-60": [time_to_60]
    })

    mpg_pred = model.predict(input_data)[0]
    st.success(f"ì˜ˆìƒ ì—°ë¹„: **{mpg_pred:.2f} mpg** ğŸš˜")

def main():
    st.set_page_config(page_title="ìë™ì°¨ ì—°ë¹„ ëŒ€ì‹œë³´ë“œ", layout="wide")

    # --- ì‚¬ì´ë“œë°” ë©”ë‰´ ---
    menu = st.sidebar.radio(
        "ëŒ€ì‹œë³´ë“œ ë©”ë‰´",
        ["í™ˆ", "ìê¸°ì†Œê°œ", "ë‚˜ì˜ ì‹œê°„í‘œ", "íƒìƒ‰ì  ìë£Œë¶„ì„(EDA)", "ì—°ë¹„ ì˜ˆì¸¡"]
    )

    df = load_data()  # main()í•¨ìˆ˜ì— ì¶”ê°€


    # --- í™ˆ í™”ë©´ ---
    if menu == "í™ˆ":
        cars_home()
    # --- ìê¸°ì†Œê°œ í™”ë©´ ---
    elif menu == "ìê¸°ì†Œê°œ":
        page_intro()

    # --- ë‚˜ì˜ ì‹œê°„í‘œ í™”ë©´ ---
    elif menu == "ë‚˜ì˜ ì‹œê°„í‘œ":
        page_timetable()

    # --- íƒìƒ‰ì  ìë£Œë¶„ì„ í™”ë©´ ---
    elif menu == "íƒìƒ‰ì  ìë£Œë¶„ì„(EDA)":
        cars_EDA(df)

    # --- ì—°ë¹„ ì˜ˆì¸¡ í™”ë©´ ---
    elif menu == "ì—°ë¹„ ì˜ˆì¸¡":
        cars_predict(df) 


if __name__ == "__main__":
    main()
